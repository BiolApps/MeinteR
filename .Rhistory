group1.geo <- quads.inc[[2]]$quads
group2.geo<- quads.dec[[2]]$quads
quads.inc.dec.geo <- c(group1.geo,group2.geo)
class <- c(rep("DMS+", length(group1.geo)), rep("DMS-",length(group2.geo)))
density.df <- data.frame(quads.inc.dec.geo,class)
density.df$quads.inc.dec.geo[density.df$quads.inc.dec.geo > 6] <- 6
p.GEO <- ggplot(density.df, aes(x = quads.inc.dec.geo, fill = factor(class))) +
# geom_bar(alpha = 0.6) +
geom_histogram(aes(y = ..density..),position="identity", binwidth = 1, alpha = 0.7) +
stat_function(fun = dnorm, aes(color = "DMS+"), size = 1, args = list(mean = mean(density.df$quads.inc.dec.geo[density.df$class=="DMS+"]), sd = sd(density.df$quads.inc.dec.geo[density.df$class=="DMS+"]))) +
stat_function(fun = dnorm, aes(color = "DMS-"), size = 1, args = list(mean = mean(density.df$quads.inc.dec.geo[density.df$class=="DMS-"]), sd = sd(density.df$quads.inc.dec.geo[density.df$class=="DMS-"]))) +
scale_color_manual(values=c("red", "blue","#999999", "#E69F00", "#56B4E9"))+
scale_fill_manual(values=c("#999999", "#E69F00", "#56B4E9"),name=" ")+
labs( x="G-Quadruplex", y = "Density")+
scale_x_continuous(breaks=seq(0,6,1)) +
theme_bw() +
theme(axis.text.x=element_text(size=30, angle=0))+
theme(axis.text.y=element_text(size=30, angle=90))+
theme(axis.title=element_text(size=30))+
theme(legend.text=element_text(size=20))+
theme(legend.position=c(0.8,0.8))+
theme(legend.title=element_blank()) +
ggtitle("GEO-BRCA") +
theme(plot.title = element_text(margin = margin(t = 10, b = -30))) +
theme(plot.title = element_text(hjust = 0.5, size=22))
p.GEO
evaluation3 <- function(DEX, aggr, pirate.title, pdf=pdf, logfc.low=logfc.low, logfc.high=logfc.high) {
res.df <- vector()
#pdf(file=pdf)
#CHUNK 1 - shows that differentially methylated sites are more often differentially expressed with p<0.0001
tt <- t.test(DEX$logFC, aggr$logFC)
res.df <- c(res.df, tt$p.value, mean(abs(aggr$logFC)),mean(abs(DEX$logFC)))
# normalized density plots
df1 <- data.frame(aggr$logFC, group="DMS ∩ DEx")
colnames(df1)<- c("data", "Dataset")
df2 <- data.frame(DEX$logFC, group="DEx")
colnames(df2)<- c("data", "Dataset")
df <- rbind(df1,df2)
library(scales) # For percent_format()
library(ggplot2)
print(ggplot(df, aes(data, fill=Dataset)) +
geom_density(aes(y=2*(..density..)/sum(..density..)),  alpha=0.8,
position="identity", lwd=0.8) +
scale_y_continuous(labels=percent_format(accuracy = .1)) +
scale_fill_manual(values=c("#9999CC", "#66CC99")) +
theme(
plot.title = element_text(family = "Helvetica", hjust = 0.5, face = "bold", size = (15)),
plot.subtitle=element_text(size=15, family="Helvetica", hjust=0.5),  # subtitle
axis.text.x = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
axis.text.y = element_text(colour="grey20",size=20,angle=0,hjust=1,vjust=0,face="plain"),
axis.title.x = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=0,face="plain"),
axis.title.y = element_text(colour="grey20",size=20,angle=90,hjust=.5,vjust=.5,face="plain"),
legend.title = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
legend.text = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.position = c(.95, .95),
legend.justification = c("right", "top"),
legend.box.just = "left",
legend.title=element_blank(),
legend.margin = margin(5, 5, 5, 5)),
labs(x= bquote('logfc'), y = "Density"))
#labs(x= bquote(paste('log'['2']*'fc')), y = "Density"))
# END CHUNK 1
#CHUNK 2 - idx3 is increasing in DEG?
logfc.0 <- subset(aggr, abs(aggr$logFC) < logfc.low)
logfc.1 <- subset(aggr, abs(aggr$logFC) > logfc.high)
p <- t.test(logfc.0$idx3,logfc.1$idx3)
res.df <- c(res.df, mean(logfc.0$idx3),mean(logfc.1$idx3), p$p.value)
aggr$idx.bin <- aggr$idx3 < 1
aggr$idx.bin[aggr$idx.bin == FALSE] <- "high"
aggr$idx.bin[aggr$idx.bin == TRUE] <- "low"
test <- paste0("p-value= ", round(p$p.value,3))
pirateplot(formula = abs(logFC) ~ idx.bin,
point.o = .2,
pal = "pony",
data = aggr,
cex.lab = 2.5,
cex.axis = 2.5,
cex.names = 2.5,
xlab = bquote('logfc'),
ylab = " ")
#mtext("Genomic index",side=2, font=10, cex=2, line =2.5)
#mtext(text = test, side = 3,font = 3)
point.sizes <- runif(100, min = .2, max = 2) # Just for fun
plot(abs(aggr$logFC), aggr$idx3,
pch = 21,
bg = piratepal("pony", trans = .1),
col = "white",
bty = "n",
cex = point.sizes,
cex.lab = 1.8,
cex.axis = 1.8,
cex.names = 1.8,
xlab = bquote('logfc'),
ylab = " ")
mtext("Genomic index",side=2, font=10, cex=2, line =2.5)
grid() # Add gridlines
model <- lm(formula = abs(logFC) ~ idx3,
data = aggr)
abline(model,
col = 'black', lwd=3, lty=2)
summary(model)
#CHUNK 3 - correlation between hyper/hypos and adjusted p-values in gene expression
aggr$score.bin <- aggr$score < 0 #if TRUE then dMeS-
p <- t.test(aggr$logFC[aggr$score.bin == FALSE],aggr$logFC[aggr$score.bin == TRUE])
res.df <- c(res.df, p$p.value, mean(aggr$logFC[aggr$score.bin == FALSE]), mean(aggr$logFC[aggr$score.bin == TRUE]))
aggr$score.bin[aggr$score.bin == FALSE] <- "DMS+"
aggr$score.bin[aggr$score.bin == TRUE] <- "DMS-"
test <- paste0("p-value= ", round(p$p.value,3))
pirateplot(formula = logFC ~ score.bin,
point.o = .1,
pal = "xmen",
data = aggr,
cex.lab = 1.5,
cex.axis = 1.5,
cex.names = 1.5,
xlab="",
ylab = " ")
mtext(bquote('logfc'),side=2, font=20, cex=2, line =2)
abline(h=0, col="black", lwd=3, lty=2)
names(res.df) = c()
write.csv(res.df, file=paste0(pdf, ".txt"), quote=FALSE, row.names=FALSE)
print(res.df)
#  dev.off()
}
library("yarrr")
# a) BLCA GEO
working.dir <- "/Users/andigoni/Desktop/evaluations/evaluation_3/"
pdf <-  paste0(working.dir, "BLCA-GEO.pdf")
GEO.DEX.BLCA <- read.csv("/Users/andigoni/Desktop/evaluations/evaluation_3/GSE37816/DEX.csv", sep="\t")
GEO.DEX.BLCA <- subset(GEO.DEX.BLCA,!(GEO.DEX.BLCA$logFC > quantile(GEO.DEX.BLCA$logFC, probs=c(.005, .995))[2] | GEO.DEX.BLCA$logFC < quantile(GEO.DEX.BLCA$logFC, probs=c(.005, .995))[1]) )
mtx.blca <- read.csv(file="/Users/andigoni/Desktop/evaluations/evaluation_3/GSE37816/BLCA_signature.csv", header=TRUE, stringsAsFactors = FALSE)
aggr.blca <- merge(mtx.blca, GEO.DEX.BLCA, by.x="name", by.y="Gene.symbol")
# original DEx dataset
DEX <- GEO.DEX.BLCA
# intersected DEx + DNAm dataset
aggr <- aggr.blca
pirate.title <-"BLCA-GSE37816"
logfc.low = 1
logfc.high = 1
evaluation3(DEX=DEX, aggr=aggr, pirate.title=pirate.title, pdf=pdf, logfc.low = logfc.low, logfc.high=logfc.high)
evaluation3 <- function(DEX, aggr, pirate.title, pdf=pdf, logfc.low=logfc.low, logfc.high=logfc.high) {
res.df <- vector()
#pdf(file=pdf)
#CHUNK 1 - shows that differentially methylated sites are more often differentially expressed with p<0.0001
tt <- t.test(DEX$logFC, aggr$logFC)
res.df <- c(res.df, tt$p.value, mean(abs(aggr$logFC)),mean(abs(DEX$logFC)))
# normalized density plots
df1 <- data.frame(aggr$logFC, group="DMS ∩ DEx")
colnames(df1)<- c("data", "Dataset")
df2 <- data.frame(DEX$logFC, group="DEx")
colnames(df2)<- c("data", "Dataset")
df <- rbind(df1,df2)
library(scales) # For percent_format()
library(ggplot2)
print(ggplot(df, aes(data, fill=Dataset)) +
geom_density(aes(y=2*(..density..)/sum(..density..)),  alpha=0.8,
position="identity", lwd=0.8) +
scale_y_continuous(labels=percent_format(accuracy = .1)) +
scale_fill_manual(values=c("#9999CC", "#66CC99")) +
theme(
plot.title = element_text(family = "Helvetica", hjust = 0.5, face = "bold", size = (15)),
plot.subtitle=element_text(size=15, family="Helvetica", hjust=0.5),  # subtitle
axis.text.x = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
axis.text.y = element_text(colour="grey20",size=20,angle=0,hjust=1,vjust=0,face="plain"),
axis.title.x = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=0,face="plain"),
axis.title.y = element_text(colour="grey20",size=20,angle=90,hjust=.5,vjust=.5,face="plain"),
legend.title = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
legend.text = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.position = c(.95, .95),
legend.justification = c("right", "top"),
legend.box.just = "left",
legend.title=element_blank(),
legend.margin = margin(5, 5, 5, 5)),
labs(x= bquote('logfc'), y = "Density"))
#labs(x= bquote(paste('log'['2']*'fc')), y = "Density"))
# END CHUNK 1
#CHUNK 2 - idx3 is increasing in DEG?
logfc.0 <- subset(aggr, abs(aggr$logFC) < logfc.low)
logfc.1 <- subset(aggr, abs(aggr$logFC) > logfc.high)
p <- t.test(logfc.0$idx3,logfc.1$idx3)
res.df <- c(res.df, mean(logfc.0$idx3),mean(logfc.1$idx3), p$p.value)
aggr$idx.bin <- aggr$idx3 < 1
aggr$idx.bin[aggr$idx.bin == FALSE] <- "high"
aggr$idx.bin[aggr$idx.bin == TRUE] <- "low"
test <- paste0("p-value= ", round(p$p.value,3))
pirateplot(formula = abs(logFC) ~ idx.bin,
point.o = .2,
pal = "pony",
data = aggr,
cex.lab = 2.5,
cex.axis = 2.5,
cex.names = 2.5,
xlab = bquote('logfc'),
ylab = " ")
#mtext("Genomic index",side=2, font=10, cex=2, line =2.5)
#mtext(text = test, side = 3,font = 3)
point.sizes <- runif(100, min = .2, max = 2) # Just for fun
plot(abs(aggr$logFC), aggr$idx3,
pch = 21,
bg = piratepal("pony", trans = .1),
col = "white",
bty = "n",
cex = point.sizes,
cex.lab = 1.8,
cex.axis = 1.8,
cex.names = 1.8,
xlab = bquote('logfc'),
ylab = " ")
mtext("Genomic index",side=2, font=10, cex=2, line =2.5)
grid() # Add gridlines
model <- lm(formula = abs(logFC) ~ idx3,
data = aggr)
abline(model,
col = 'black', lwd=3, lty=2)
summary(model)
#CHUNK 3 - correlation between hyper/hypos and adjusted p-values in gene expression
aggr$score.bin <- aggr$score < 0 #if TRUE then dMeS-
p <- t.test(aggr$logFC[aggr$score.bin == FALSE],aggr$logFC[aggr$score.bin == TRUE])
res.df <- c(res.df, p$p.value, mean(aggr$logFC[aggr$score.bin == FALSE]), mean(aggr$logFC[aggr$score.bin == TRUE]))
aggr$score.bin[aggr$score.bin == FALSE] <- "DMS+"
aggr$score.bin[aggr$score.bin == TRUE] <- "DMS-"
test <- paste0("p-value= ", round(p$p.value,3))
pirateplot(formula = logFC ~ score.bin,
point.o = .1,
pal = "xmen",
data = aggr,
cex.lab = 1.5,
cex.axis = 1.5,
cex.names = 1.5,
xlab="",
ylab = " ")
mtext(bquote('logfc'),side=2, font=20, cex=2, line =2)
abline(h=0, col="black", lwd=3, lty=2)
names(res.df) = c()
write.csv(res.df, file=paste0(pdf, ".txt"), quote=FALSE, row.names=FALSE)
print(res.df)
#  dev.off()
}
library("yarrr")
# a) BLCA GEO
working.dir <- "/Users/andigoni/Desktop/evaluations/evaluation_3/"
pdf <-  paste0(working.dir, "BLCA-GEO.pdf")
GEO.DEX.BLCA <- read.csv("/Users/andigoni/Desktop/evaluations/evaluation_3/GSE37816/DEX.csv", sep="\t")
GEO.DEX.BLCA <- subset(GEO.DEX.BLCA,!(GEO.DEX.BLCA$logFC > quantile(GEO.DEX.BLCA$logFC, probs=c(.005, .995))[2] | GEO.DEX.BLCA$logFC < quantile(GEO.DEX.BLCA$logFC, probs=c(.005, .995))[1]) )
mtx.blca <- read.csv(file="/Users/andigoni/Desktop/evaluations/evaluation_3/GSE37816/BLCA_signature.csv", header=TRUE, stringsAsFactors = FALSE)
aggr.blca <- merge(mtx.blca, GEO.DEX.BLCA, by.x="name", by.y="Gene.symbol")
# original DEx dataset
DEX <- GEO.DEX.BLCA
# intersected DEx + DNAm dataset
aggr <- aggr.blca
pirate.title <-"BLCA-GSE37816"
logfc.low = 1
logfc.high = 1
evaluation3(DEX=DEX, aggr=aggr, pirate.title=pirate.title, pdf=pdf, logfc.low = logfc.low, logfc.high=logfc.high)
evaluation3 <- function(DEX, aggr, pirate.title, pdf=pdf, logfc.low=logfc.low, logfc.high=logfc.high) {
res.df <- vector()
#pdf(file=pdf)
#CHUNK 1 - shows that differentially methylated sites are more often differentially expressed with p<0.0001
tt <- t.test(DEX$logFC, aggr$logFC)
res.df <- c(res.df, tt$p.value, mean(abs(aggr$logFC)),mean(abs(DEX$logFC)))
# normalized density plots
df1 <- data.frame(aggr$logFC, group="DMS ∩ DEx")
colnames(df1)<- c("data", "Dataset")
df2 <- data.frame(DEX$logFC, group="DEx")
colnames(df2)<- c("data", "Dataset")
df <- rbind(df1,df2)
library(scales) # For percent_format()
library(ggplot2)
print(ggplot(df, aes(data, fill=Dataset)) +
geom_density(aes(y=2*(..density..)/sum(..density..)),  alpha=0.8,
position="identity", lwd=0.8) +
scale_y_continuous(labels=percent_format(accuracy = .1)) +
scale_fill_manual(values=c("#9999CC", "#66CC99")) +
theme(
plot.title = element_text(family = "Helvetica", hjust = 0.5, face = "bold", size = (15)),
plot.subtitle=element_text(size=15, family="Helvetica", hjust=0.5),  # subtitle
axis.text.x = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
axis.text.y = element_text(colour="grey20",size=20,angle=0,hjust=1,vjust=0,face="plain"),
axis.title.x = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=0,face="plain"),
axis.title.y = element_text(colour="grey20",size=20,angle=90,hjust=.5,vjust=.5,face="plain"),
#            legend.title = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
legend.text = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.position = c(.95, .95),
legend.justification = c("right", "top"),
legend.box.just = "left",
legend.title=element_blank(),
legend.margin = margin(5, 5, 5, 5)),
labs(x= bquote('logfc'), y = "Density"))
#labs(x= bquote(paste('log'['2']*'fc')), y = "Density"))
# END CHUNK 1
#CHUNK 2 - idx3 is increasing in DEG?
logfc.0 <- subset(aggr, abs(aggr$logFC) < logfc.low)
logfc.1 <- subset(aggr, abs(aggr$logFC) > logfc.high)
p <- t.test(logfc.0$idx3,logfc.1$idx3)
res.df <- c(res.df, mean(logfc.0$idx3),mean(logfc.1$idx3), p$p.value)
aggr$idx.bin <- aggr$idx3 < 1
aggr$idx.bin[aggr$idx.bin == FALSE] <- "high"
aggr$idx.bin[aggr$idx.bin == TRUE] <- "low"
test <- paste0("p-value= ", round(p$p.value,3))
pirateplot(formula = abs(logFC) ~ idx.bin,
point.o = .2,
pal = "pony",
data = aggr,
cex.lab = 2.5,
cex.axis = 2.5,
cex.names = 2.5,
xlab = bquote('logfc'),
ylab = " ")
#mtext("Genomic index",side=2, font=10, cex=2, line =2.5)
#mtext(text = test, side = 3,font = 3)
point.sizes <- runif(100, min = .2, max = 2) # Just for fun
plot(abs(aggr$logFC), aggr$idx3,
pch = 21,
bg = piratepal("pony", trans = .1),
col = "white",
bty = "n",
cex = point.sizes,
cex.lab = 1.8,
cex.axis = 1.8,
cex.names = 1.8,
xlab = bquote('logfc'),
ylab = " ")
mtext("Genomic index",side=2, font=10, cex=2, line =2.5)
grid() # Add gridlines
model <- lm(formula = abs(logFC) ~ idx3,
data = aggr)
abline(model,
col = 'black', lwd=3, lty=2)
summary(model)
#CHUNK 3 - correlation between hyper/hypos and adjusted p-values in gene expression
aggr$score.bin <- aggr$score < 0 #if TRUE then dMeS-
p <- t.test(aggr$logFC[aggr$score.bin == FALSE],aggr$logFC[aggr$score.bin == TRUE])
res.df <- c(res.df, p$p.value, mean(aggr$logFC[aggr$score.bin == FALSE]), mean(aggr$logFC[aggr$score.bin == TRUE]))
aggr$score.bin[aggr$score.bin == FALSE] <- "DMS+"
aggr$score.bin[aggr$score.bin == TRUE] <- "DMS-"
test <- paste0("p-value= ", round(p$p.value,3))
pirateplot(formula = logFC ~ score.bin,
point.o = .1,
pal = "xmen",
data = aggr,
cex.lab = 1.5,
cex.axis = 1.5,
cex.names = 1.5,
xlab="",
ylab = " ")
mtext(bquote('logfc'),side=2, font=20, cex=2, line =2)
abline(h=0, col="black", lwd=3, lty=2)
names(res.df) = c()
write.csv(res.df, file=paste0(pdf, ".txt"), quote=FALSE, row.names=FALSE)
print(res.df)
#  dev.off()
}
evaluation3(DEX=DEX, aggr=aggr, pirate.title=pirate.title, pdf=pdf, logfc.low = logfc.low, logfc.high=logfc.high)
evaluation3 <- function(DEX, aggr, pirate.title, pdf=pdf, logfc.low=logfc.low, logfc.high=logfc.high) {
res.df <- vector()
#pdf(file=pdf)
#CHUNK 1 - shows that differentially methylated sites are more often differentially expressed with p<0.0001
tt <- t.test(DEX$logFC, aggr$logFC)
res.df <- c(res.df, tt$p.value, mean(abs(aggr$logFC)),mean(abs(DEX$logFC)))
# normalized density plots
df1 <- data.frame(aggr$logFC, group="DMS ∩ DEx")
colnames(df1)<- c("data", "Dataset")
df2 <- data.frame(DEX$logFC, group="DEx")
colnames(df2)<- c("data", "Dataset")
df <- rbind(df1,df2)
library(scales) # For percent_format()
library(ggplot2)
print(ggplot(df, aes(data, fill=Dataset)) +
geom_density(aes(y=2*(..density..)/sum(..density..)),  alpha=0.8,
position="identity", lwd=0.8) +
scale_y_continuous(labels=percent_format(accuracy = .1)) +
scale_fill_manual(values=c("#9999CC", "#66CC99")) +
theme(
plot.title = element_text(family = "Helvetica", hjust = 0.5, face = "bold", size = (15)),
plot.subtitle=element_text(size=15, family="Helvetica", hjust=0.5),  # subtitle
axis.text.x = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
axis.text.y = element_text(colour="grey20",size=20,angle=0,hjust=1,vjust=0,face="plain"),
axis.title.x = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=0,face="plain"),
axis.title.y = element_text(colour="grey20",size=20,angle=90,hjust=.5,vjust=.5,face="plain"),
#            legend.title = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
legend.text = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.position = c(.95, .95),
legend.justification = c("right", "top"),
legend.box.just = "left",
legend.title=element_blank(),
legend.margin = margin(5, 5, 5, 5)),
labs(x= bquote('logfc'), y = "Density"))
#labs(x= bquote(paste('log'['2']*'fc')), y = "Density"))
# END CHUNK 1
#CHUNK 2 - idx3 is increasing in DEG?
logfc.0 <- subset(aggr, abs(aggr$logFC) < logfc.low)
logfc.1 <- subset(aggr, abs(aggr$logFC) > logfc.high)
p <- t.test(logfc.0$idx3,logfc.1$idx3)
res.df <- c(res.df, mean(logfc.0$idx3),mean(logfc.1$idx3), p$p.value)
aggr$idx.bin <- aggr$idx3 < 1
aggr$idx.bin[aggr$idx.bin == FALSE] <- "high"
aggr$idx.bin[aggr$idx.bin == TRUE] <- "low"
test <- paste0("p-value= ", round(p$p.value,3))
pirateplot(formula = abs(logFC) ~ idx.bin,
point.o = .2,
pal = "pony",
data = aggr,
cex.lab = 2.5,
cex.axis = 2.5,
cex.names = 2.5,
xlab = bquote('logfc'),
ylab = " ")
#mtext("Genomic index",side=2, font=10, cex=2, line =2.5)
#mtext(text = test, side = 3,font = 3)
point.sizes <- runif(100, min = .2, max = 2) # Just for fun
plot(abs(aggr$logFC), aggr$idx3,
pch = 21,
bg = piratepal("pony", trans = .1),
col = "white",
bty = "n",
cex = point.sizes,
cex.lab = 1.8,
cex.axis = 1.8,
cex.names = 1.8,
xlab = bquote('logfc'),
ylab = " ")
mtext("Genomic index",side=2, font=10, cex=2, line =2.5)
grid() # Add gridlines
model <- lm(formula = abs(logFC) ~ idx3,
data = aggr)
abline(model,
col = 'black', lwd=3, lty=2)
summary(model)
#CHUNK 3 - correlation between hyper/hypos and adjusted p-values in gene expression
aggr$score.bin <- aggr$score < 0 #if TRUE then dMeS-
p <- t.test(aggr$logFC[aggr$score.bin == FALSE],aggr$logFC[aggr$score.bin == TRUE])
res.df <- c(res.df, p$p.value, mean(aggr$logFC[aggr$score.bin == FALSE]), mean(aggr$logFC[aggr$score.bin == TRUE]))
aggr$score.bin[aggr$score.bin == FALSE] <- "DMS+"
aggr$score.bin[aggr$score.bin == TRUE] <- "DMS-"
test <- paste0("p-value= ", round(p$p.value,3))
pirateplot(formula = logFC ~ score.bin,
point.o = .1,
pal = "xmen",
data = aggr,
cex.lab = 1.5,
cex.axis = 1.5,
cex.names = 1.5,
xlab="",
ylab = " ")
mtext(bquote('logfc'),side=2, font=20, cex=2, line =2)
abline(h=0, col="black", lwd=3, lty=2)
names(res.df) = c()
write.csv(res.df, file=paste0(pdf, ".txt"), quote=FALSE, row.names=FALSE)
print(res.df)
#  dev.off()
}
library("yarrr")
# a) BLCA GEO
working.dir <- "/Users/andigoni/Desktop/evaluations/evaluation_3/"
pdf <-  paste0(working.dir, "BLCA-GEO.pdf")
GEO.DEX.BLCA <- read.csv("/Users/andigoni/Desktop/evaluations/evaluation_3/GSE37816/DEX.csv", sep="\t")
GEO.DEX.BLCA <- subset(GEO.DEX.BLCA,!(GEO.DEX.BLCA$logFC > quantile(GEO.DEX.BLCA$logFC, probs=c(.005, .995))[2] | GEO.DEX.BLCA$logFC < quantile(GEO.DEX.BLCA$logFC, probs=c(.005, .995))[1]) )
mtx.blca <- read.csv(file="/Users/andigoni/Desktop/evaluations/evaluation_3/GSE37816/BLCA_signature.csv", header=TRUE, stringsAsFactors = FALSE)
aggr.blca <- merge(mtx.blca, GEO.DEX.BLCA, by.x="name", by.y="Gene.symbol")
# original DEx dataset
DEX <- GEO.DEX.BLCA
# intersected DEx + DNAm dataset
aggr <- aggr.blca
pirate.title <-"BLCA-GSE37816"
logfc.low = 1
logfc.high = 1
evaluation3(DEX=DEX, aggr=aggr, pirate.title=pirate.title, pdf=pdf, logfc.low = logfc.low, logfc.high=logfc.high)
dev.off()
evaluation3(DEX=DEX, aggr=aggr, pirate.title=pirate.title, pdf=pdf, logfc.low = logfc.low, logfc.high=logfc.high)
res.df <- vector()
#pdf(file=pdf)
#CHUNK 1 - shows that differentially methylated sites are more often differentially expressed with p<0.0001
tt <- t.test(DEX$logFC, aggr$logFC)
res.df <- c(res.df, tt$p.value, mean(abs(aggr$logFC)),mean(abs(DEX$logFC)))
# normalized density plots
df1 <- data.frame(aggr$logFC, group="DMS ∩ DEx")
colnames(df1)<- c("data", "Dataset")
df2 <- data.frame(DEX$logFC, group="DEx")
colnames(df2)<- c("data", "Dataset")
df <- rbind(df1,df2)
library(scales) # For percent_format()
library(ggplot2)
print(ggplot(df, aes(data, fill=Dataset)) +
geom_density(aes(y=2*(..density..)/sum(..density..)),  alpha=0.8,
position="identity", lwd=0.8) +
scale_y_continuous(labels=percent_format(accuracy = .1)) +
scale_fill_manual(values=c("#9999CC", "#66CC99")) +
theme(
plot.title = element_text(family = "Helvetica", hjust = 0.5, face = "bold", size = (15)),
plot.subtitle=element_text(size=15, family="Helvetica", hjust=0.5),  # subtitle
axis.text.x = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
axis.text.y = element_text(colour="grey20",size=20,angle=0,hjust=1,vjust=0,face="plain"),
axis.title.x = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=0,face="plain"),
axis.title.y = element_text(colour="grey20",size=20,angle=90,hjust=.5,vjust=.5,face="plain"),
#            legend.title = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
legend.text = element_text(colour="grey20",size=20,angle=0,hjust=.5,vjust=.5,face="plain"),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.position = c(.95, .95),
legend.justification = c("right", "top"),
legend.box.just = "left",
legend.title=element_blank(),
legend.margin = margin(5, 5, 5, 5)),
labs(x= bquote('logfc'), y = "Density"))
